<?php
require_once 'paths.php';
require_once COMMON;
require_once FILE_MANAGER;
header("Content-Type: application/json");

$false_message='[{"tag":"string","sons":["A problem has occurred."]}]';
$true_message='[{"tag":"string","sons":["Weâ€™ve sent you an email to verify that your password has been changed."]}]';
$incorrected_password_message='[{"tag":"string","sons":["Incorrect password."]}]';


$fm=new FileManager(get('host'));
if($fm->access(get('username'),get('current_password'))){
  $socket=stream_socket_client(SOCKET,$errno,$errstr);
  if($socket){
    $host=get('host');
    $username=get('username');
    $current_password=get('current_password');
    $new_password=get('new_password');
    fwrite($socket,"password_change|$host|$username|$current_password|$new_password\n");
    fclose($socket);
    $_SESSION['password']=get('new_password');
    echo $true_message;
    }
  else echo $false_message;
  }
else echo $incorrected_password_message;
?>
